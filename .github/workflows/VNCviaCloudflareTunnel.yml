name: VNC via Cloudflare Tunnel
on: workflow_dispatch

jobs:
  deploy-vnc:
    runs-on: ubuntu-latest
    timeout-minutes: 360

    steps:
    # Ù…Ø±Ø­Ù„Ù‡ 1: Ù†ØµØ¨ VNC
    - name: Setup VNC Server
      run: |
        sudo apt update
        sudo apt install -y xfce4 tightvncserver
        mkdir -p ~/.vnc
        echo -e "1aq2sw@3de\n1aq2sw@3de\nn" | vncpasswd
        vncserver :1 -geometry 1280x800 -localhost

    # Ù…Ø±Ø­Ù„Ù‡ 2: ØªÙ†Ø¸ÛŒÙ… ØªÙˆÙ†Ù„ (Ø§ØµÙ„Ø§Ø­ Ø´Ø¯Ù‡)
    - name: Configure Cloudflare Tunnel
      env:
        CLOUDFLARE_TUNNEL_TOKEN: ${{ secrets.CLOUDFLARE_TUNNEL_TOKEN }}
      run: |
        wget https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64
        chmod +x cloudflared
        
        # Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² Ù†Ø§Ù… ØªÙˆÙ†Ù„ Ø¨Ù‡ Ø¬Ø§ÛŒ UUID
        ./cloudflared tunnel --url tcp://localhost:5901 --name github-vnc-tunnel --credentials-file ./tunnel.json run --token $CLOUDFLARE_TUNNEL_TOKEN &
        sleep 15

    # Ù…Ø±Ø­Ù„Ù‡ 3: Ù†Ú¯Ù‡ Ø¯Ø§Ø´ØªÙ† Ø¬Ø§Ø¨ ÙØ¹Ø§Ù„
    - name: Keep Job Alive
      run: |
        echo "âœ… VNC Active at vnc.net2ray.dpdns.org:5901"
        echo "ğŸ”‘ Password: 1aq2sw@3de"
        while true; do
          echo "$(date): Job is active"
          sleep 60
        done
