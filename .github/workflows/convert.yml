name: Node Conversion
on:
  workflow_dispatch:

jobs:
  convert:
    runs-on: windows-latest
    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      
    - name: Run conversion script
      shell: pwsh
      run: |
        .\scripts\convert-node.ps1
        
    - name: Save result
      run: |
        $content = Get-Content .\result.txt -Raw
        echo "::set-output name=content::$content"
      id: save-result
      
    - name: Create output file
      uses: actions/github-script@v6
      with:
        script: |
          const fs = require('fs');
          fs.writeFileSync('converted-node.txt', '${{ steps.save-result.outputs.content }}');
          
    - name: Commit result
      run: |
        git config user.name "GitHub Actions"
        git config user.email "actions@github.com"
        git add converted-node.txt
        git commit -m "Add converted node"
        git push
